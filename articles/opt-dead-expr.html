<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dead Expression Elimination â€¢ rco</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Dead Expression Elimination">
<meta property="og:description" content="rco">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rco</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Optimizers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/opt-common-subexpr.html">Common Subexpression Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-constant-folding.html">Constant Folding</a>
    </li>
    <li>
      <a href="../articles/opt-constant-propagation.html">Constant Propagation</a>
    </li>
    <li>
      <a href="../articles/opt-dead-code.html">Dead Code Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-dead-expr.html">Dead Expression Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-dead-store.html">Dead Store Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-loop-invariant.html">Loop-invariant Code Motion</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/contributing-an-optimizer.html">Contributing an Optimizer</a>
    </li>
    <li>
      <a href="../articles/potential-optimizers.html">Potential Optimizers</a>
    </li>
    <li>
      <a href="../articles/docker-readme.html">Docker Image</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jcrodriguez1989/rco/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="opt-dead-expr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Dead Expression Elimination</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jcrodriguez1989/rco/blob/master/vignettes/opt-dead-expr.Rmd"><code>vignettes/opt-dead-expr.Rmd</code></a></small>
      <div class="hidden name"><code>opt-dead-expr.Rmd</code></div>

    </div>

    
    
<div id="dead-expression-elimination" class="section level1">
<h1 class="hasAnchor">
<a href="#dead-expression-elimination" class="anchor"></a>Dead Expression Elimination</h1>
<div id="idea" class="section level2">
<h2 class="hasAnchor">
<a href="#idea" class="anchor"></a>Idea</h2>
<p>The basic idea behind the dead expression elimination optimizer is to remove all those expressions whose result is neither used in the program, nor the removal of which affects the result of the code. Therefore this <em>dead expression elimination</em> frees up memory, saves computation time, and provides a speed boost.</p>
</div>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>Dead Expression Elimination intends to remove those expressions that do not modify the environment.</p>
<p>In R, when evaluating an expression which is not assigned to any variable, its result will be seen in the console. However, when the expression is within a function definition, the value will not be printed, the environment will not be modified, and anyway the computational cost will be incurred.</p>
<p>For example, in the code:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">foo</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="no">val</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1</span>)
  <span class="no">e</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="fl">1</span>)
  <span class="no">val</span>
  <span class="no">res</span> <span class="kw">&lt;-</span> <span class="no">e</span> ^ <span class="no">val</span>
}</pre></body></html></div>
<p>The unassigned <code>val</code> expression is a dead expression, and could be removed.</p>
<p>This optimization strategy is closely related to <a href="opt-dead-store.html">dead store elimination</a>, since when a dead store is deleted, it is possible that a dead expression is generated.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Consider the following example:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">code</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(
  <span class="st">"foo &lt;- function(n) {"</span>,
  <span class="st">"  i &lt;- 0"</span>,
  <span class="st">"  res &lt;- 0"</span>,
  <span class="st">"  while (i &lt; n) {"</span>,
  <span class="st">"    res &lt;- res + i"</span>,
  <span class="st">"    i &lt;- i + 1"</span>,
  <span class="st">"    res"</span>,
  <span class="st">"  }"</span>,
  <span class="st">"  res"</span>,
  <span class="st">"}"</span>,
  <span class="st">"foo(10000)"</span>,
  <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\n"</span>
)
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="no">code</span>)</pre></body></html></div>
<pre><code>## foo &lt;- function(n) {
##   i &lt;- 0
##   res &lt;- 0
##   while (i &lt; n) {
##     res &lt;- res + i
##     i &lt;- i + 1
##     res
##   }
##   res
## }
## foo(10000)</code></pre>
<p>Then, the automatically optimized code would be:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">opt_code</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/opt_dead_expr.html">opt_dead_expr</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">code</span>))
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="no">opt_code</span>$<span class="no">codes</span><span class="kw">[[</span><span class="fl">1</span>]])</pre></body></html></div>
<pre><code>## foo &lt;- function(n) {
##   i &lt;- 0
##   res &lt;- 0
##   while (i &lt; n) {
##     res &lt;- res + i
##     i &lt;- i + 1
##   }
##   res
## }
## foo(10000)</code></pre>
<p>And if we measure the execution time of each one, and the speed-up:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">bmark_res</span> <span class="kw">&lt;-</span> <span class="fu">microbenchmark</span>({
  <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">code</span>))
}, {
  <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">opt_code</span>))
})
<span class="fu">autoplot</span>(<span class="no">bmark_res</span>)</pre></body></html></div>
<p><img src="opt-dead-expr_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">speed_up</span>(<span class="no">bmark_res</span>)</pre></body></html></div>
<pre><code>##           Min.  1st Qu.  Median     Mean 3rd Qu.     Max.
## Expr_2 5.66842 5.508355 5.26023 7.281012 4.82452 48.79953</code></pre>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h2>
<p>The <code>opt_dead_expr</code> detects which code chunks are function definitions. Then for each function, the optimizer gets it body, detects dead expressions, i.e., not assigned expressions, and eliminates them if they are not returned by the function.</p>
<p>An expression will be considered a dead expression if:</p>
<ul>
<li>Its result is not assigned to a variable.</li>
<li>It contains subexpressions only in: NUM_CONST, STR_CONST, NULL_CONST, â€˜+â€™, â€˜-â€™, â€™*â€˜,â€™/â€˜,â€™^â€˜, GT, GE, LT, LE, EQ, NE,â€™!â€˜, AND, OR, AND2, OR2,â€™(â€˜,â€™)â€˜,â€™{â€˜,â€™}â€™, expr, SYMBOL.</li>
</ul>
</div>
<div id="to-do" class="section level2">
<h2 class="hasAnchor">
<a href="#to-do" class="anchor"></a>To-Do</h2>
<ul>
<li>
<p>Check if dead expressions have never-assigned vars?</p>
<p>The optimizer is currently eliminating any dead expression, however, the code:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">foo</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="no">x</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fl">8818</span>)
}</pre></body></html></div>
<p>is not equivalent to</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">foo</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fl">8818</span>)
}</pre></body></html></div>
<p>Both functions will return the same value, however, the first one will give an error similar to:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu">foo</span>()
<span class="co">## Error in foo() : object 'x' not found</span></pre></body></html></div>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Juan Cruz Rodriguez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

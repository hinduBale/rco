<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contributing an optimizer • rco</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Contributing an optimizer">
<meta property="og:description" content="rco">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rco</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Optimizers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/opt-common-subexpr.html">Common Subexpression Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-constant-folding.html">Constant Folding</a>
    </li>
    <li>
      <a href="../articles/opt-constant-propagation.html">Constant Propagation</a>
    </li>
    <li>
      <a href="../articles/opt-dead-code.html">Dead Code Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-dead-expr.html">Dead Expression Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-dead-store.html">Dead Store Elimination</a>
    </li>
    <li>
      <a href="../articles/opt-loop-invariant.html">Loop-invariant Code Motion</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/contributing-an-optimizer.html">Contributing an Optimizer</a>
    </li>
    <li>
      <a href="../articles/docker-readme.html">Docker Image</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jcrodriguez1989/rco/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Contributing an optimizer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jcrodriguez1989/rco/blob/master/vignettes/contributing-an-optimizer.Rmd"><code>vignettes/contributing-an-optimizer.Rmd</code></a></small>
      <div class="hidden name"><code>contributing-an-optimizer.Rmd</code></div>

    </div>

    
    
<div id="contributing-an-optimizer" class="section level1">
<h1 class="hasAnchor">
<a href="#contributing-an-optimizer" class="anchor"></a>Contributing an optimizer</h1>
<p><code>rco</code> is an open source package, and the contributions to the development of the library are more than welcome. In this guide is detailed what is the procedure commonly followed to develop a new optimizer.</p>
<p>Developing a new optimizer will require four steps that are explained below: writing the code, the test cases, the vignette, and some additional files.</p>
<div id="writing-the-code" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-the-code" class="anchor"></a>Writing the code</h2>
<p>All the code developed for the new optimizer will go in a file named <code>R/opt-**optimizer-name**.R</code>.</p>
<p>An optimizer will be a single function (one exported), which should be called <code>opt_**optimizer_name**</code>. This function will take as input a <code>texts</code> parameter that contains a string list (character vector) with the code to optimize. An example of this, with just one code to optimize, would be:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">texts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(
    <span class="st">"i &lt;- 320 * 200 * 32"</span>,
    <span class="st">"x &lt;- i * 20 + 100"</span>,
    <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\n"</span>
  )
)</pre></body></html></div>
<p>All other parameters that the function <code>opt_**optimizer_name**</code> takes as input must have an associated default parameter, for example, <code>opt_**optimizer_name** &lt;- function(texts, param1 = FALSE) { ... }</code>.</p>
<p>As output, the developed function must return a list with a field <code>codes</code> that must have the same format as the <code>texts</code> input but with the code optimized.</p>
<p>To document code we use the <a href="https://cran.r-project.org/package=roxygen2"><code>roxygen2</code></a> package. You should give a brief description of the new optimizer, of the input parameters, and an example of use.</p>
<p>As skeleton to use to develop the new optimizer we propose to follow:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r">#' Optimizer: **New Optimizer Name**
#' 
#' **New optimizer description**
#' Carefully examine the results after running this function!
#' 
#' @param texts A list of character vectors with the code to optimize.
#' **Other parameters description**
#' 
#' @examples
#' **New optimizer example of use**
#' 
#' @export
#' 
opt_**optimizer_name** &lt;- function(texts) {
  # todo: **list of possible improvements for the optimizer**
  res &lt;- list()
  **new optimizer code**
  res$codes &lt;- **...**
  return(res)
}</pre></body></html></div>
<p>For the parsing and tokenization of the code we suggest to use the functions developed in <code>R/parse.R</code>.</p>
</div>
<div id="writing-the-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-the-tests" class="anchor"></a>Writing the tests</h2>
<p>For testing, we use the <a href="https://cran.r-project.org/package=testthat"><code>testthat</code></a> package. All the code for testing the new optimizer will go in a file named <code>tests/testthat/test-opt_**optimizer_name**.R</code>.</p>
<p>Please create a test suite that covers a large percentage of possible use and border cases.</p>
<p>As skeleton to use to develop the new optimizer’s test suite we propose to follow:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">context("opt_**optimizer_name**")

test_that("**test name**", {
  **...**
})

**more test cases**</pre></body></html></div>
</div>
<div id="writing-the-vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-the-vignette" class="anchor"></a>Writing the vignette</h2>
<p>When developing a new optimizer, we create a vignette to explain it. This documentation will not only be a vignette of the package but will also be part of the <a href="https://jcrodriguez1989.github.io/rco/"><code>rco</code> website</a>.</p>
<p>For writing vignettes, we use the <a href="https://cran.r-project.org/package=knitr"><code>knitr</code></a> and <a href="https://cran.r-project.org/package=rmarkdown"><code>rmarkdown</code></a> packages. The new vignette will go in a file named <code>vignettes/opt-**optimizer-name**.Rmd</code>, and must follow the skeleton:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">---
output: rmarkdown::html_vignette
title: **New Optimizer Name**
vignette: &gt;
  %\VignetteIndexEntry{**New Optimizer Name**}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# **New Optimizer Name**

## Background

## Example

## Implementation

## **Additional headings** (optional)

## To-Do (optional)</pre></body></html></div>
<p>The <code>Background</code> section must introduce the reader to why this optimization provides improvements, and what it does. The <code>Example</code> section must give a real example to be optimized, and show the improvements it gave in terms of execution speed, memory usage, or others. The <code>Implementation</code> section must show the idea beneath the optimizer coding, this section intends to ease the understanding of the developed code if it is needed to be edited or improved. Then, as many sections as necessary can be included, where questions and challenges related to the optimizer are explained or commented. Finally, if a list of possible improvements for the optimizer were detailed, each of them should be discussed in the <code>To-Do</code> section.</p>
</div>
<div id="writing-additional-files" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-additional-files" class="anchor"></a>Writing additional files</h2>
<div id="description" class="section level3">
<h3 class="hasAnchor">
<a href="#description" class="anchor"></a><code>DESCRIPTION</code>
</h3>
<p>Package Version must be bumped, if the current version is <code>x.y.z</code> then it should be updated to <code>x.y.(z+1)</code>.</p>
</div>
<div id="news-md" class="section level3">
<h3 class="hasAnchor">
<a href="#news-md" class="anchor"></a><code>NEWS.md</code>
</h3>
<p>A entry to the <code>NEWS.md</code> file should be added:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"># rco **x.y.(z+1)**

  - Adding **New Optimizer Name** optimizer.

**...**</pre></body></html></div>
</div>
<div id="roptimizers-r" class="section level3">
<h3 class="hasAnchor">
<a href="#roptimizers-r" class="anchor"></a><code>R/optimizers.R</code>
</h3>
<p>The new optimizer function must be added to the <code>all_optimizers</code> list with its name. Also add it in its documentation, as the other optimizers are itemized.</p>
</div>
<div id="pkgdown-yml" class="section level3">
<h3 class="hasAnchor">
<a href="#pkgdown-yml" class="anchor"></a><code>_pkgdown.yml</code>
</h3>
<p>Add the new optimizer’s vignette in the website, for this, follow as it is done with the rest of the optimizers.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Juan Cruz Rodriguez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
